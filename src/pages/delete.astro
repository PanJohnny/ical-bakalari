---
import {deleteCredentials} from "../util/db";
export const prerender = false;

const body = await Astro.request.formData();
const hash = body.get('hash');

if (!hash || typeof hash !== "string") {
    return Astro.redirect('/?deleted=error');
}

try {
    const existed = await deleteCredentials(hash);
    if (!existed) {
        return Astro.redirect('/?deleted=false');
    }
    return Astro.redirect('/?deleted=true');
} catch (e) {
    console.error(e);
    return Astro.redirect('/?deleted=error');
}
---